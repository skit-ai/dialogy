<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="dialogy.types.intent package" href="dialogy.types.intent.html" /><link rel="prev" title="dialogy.workflow package" href="dialogy.workflow.html" />

    <meta name="generator" content="sphinx-4.4.0, furo 2021.11.23"/>
        <title>dialogy.base.plugin package - dialogy 0.9.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=7f0192ddeb2adecfbaa87ffbcf67d16358b30bc1" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=0af69da206d614734f649b27d4cdc2dd6c31f41d" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">dialogy 0.9.4 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">dialogy 0.9.4 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="dialogy.base.input.html">Input</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.base.output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.workflow.html">Workflow</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.types.intent.html">Intent</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.types.entity.base_entity.html">Entity</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.types.slots.html">Slots</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Types</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dialogy.types.entity.keyword.html">Pattern Entity</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.types.entity.amount_of_money.html">Currency Entity</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.types.entity.credit_card_number.html">Credit Card Number Entity</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.types.entity.numerical.html">Numeric Entity</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.types.entity.people.html">People Entity</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.types.entity.time.html">Time Entity</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.types.entity.time_interval.html">Time Interval Entity</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.types.entity.duration.html">Duration Entity</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dialogy.plugins.text.merge_asr_output.html">ASR Featurizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.plugins.text.classification.html">Intent Classifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.plugins.text.duckling_plugin.html">Duckling Entities</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.plugins.text.slot_filler.html">Slot Filler</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.plugins.text.list_entity_plugin.html">Regex Entity Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.plugins.text.list_search_plugin.html">Fuzzy Entity Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.base.entity_extractor.html">Entity Scoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.plugins.text.lb_plugin.html">Lower Bound Duckling Entities</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogy.plugins.text.combine_date_time.html">Combine DateTime Over Slots</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dialogy.utils.html">Utils</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="dialogy-base-plugin-package">
<h1>dialogy.base.plugin package<a class="headerlink" href="#dialogy-base-plugin-package" title="Permalink to this headline">¶</a></h1>
<section id="module-dialogy.base.plugin">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-dialogy.base.plugin" title="Permalink to this headline">¶</a></h2>
<section id="writing-plugins">
<span id="plugin"></span><h3>Writing Plugins<a class="headerlink" href="#writing-plugins" title="Permalink to this headline">¶</a></h3>
<p>Plugins are an abstraction over procedures that offer a specific functionality. A plugin abstracts out the way it is fed an input, and the way its output is pushed out.
A discussion about plugins requires a bit of background about <span class="xref std std-ref">Worfklows</span>, a <a class="reference internal" href="dialogy.workflow.html#workflow"><span class="std std-ref">workflow</span></a> is an ephemeral datastore. This distinction of roles
between a <a class="reference internal" href="#plugin"><span class="std std-ref">Plugin</span></a> and a <a class="reference internal" href="dialogy.workflow.html#workflow"><span class="std std-ref">Workflow</span></a> is a <strong>convention</strong> to ensure that neither the <a class="reference internal" href="#plugin"><span class="std std-ref">Plugin</span></a> creation or its <em>utility</em> is constrained
by their author’s choices.</p>
<section id="plugin-types">
<h4>Plugin Types<a class="headerlink" href="#plugin-types" title="Permalink to this headline">¶</a></h4>
<p>There are three types of plugins:</p>
<ol class="arabic simple">
<li><p>Solitary</p></li>
<li><p>Transformer</p></li>
<li><p>Trainable</p></li>
</ol>
<section id="solitary">
<h5>Solitary<a class="headerlink" href="#solitary" title="Permalink to this headline">¶</a></h5>
<p>A plugin that only interacts during the runtime of a <a class="reference internal" href="dialogy.workflow.html#workflow"><span class="std std-ref">workflow</span></a> is called a <em>Base plugin</em>.
We can create a Base plugin like so:</p>
<section id="methods">
<h6>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h6>
<p>The <strong>utility</strong> method describes the feature implemented by the plugin, this is the only required method for Base plugins. This method is called
during a workflow’s run. If a plugin produces a value, it can also be updated within workflow. Any kind of file reading, config parsing, model loading
should be done during the plugin’s initialization. <strong>utility</strong> methods must have fast execution times. This also means if there is any dynamic input required
by a plugin, it should be available within the <code class="code docutils literal notranslate"><span class="pre">*args</span></code>.</p>
<blockquote>
<div><div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>
<span class="gp">   ...: </span><span class="kn">from</span> <span class="nn">dialogy.base.plugin</span> <span class="kn">import</span> <span class="n">Plugin</span>
<span class="gp">   ...: </span><span class="kn">from</span> <span class="nn">dialogy.types</span> <span class="kn">import</span> <span class="n">PluginFn</span>
<span class="gp">   ...: </span><span class="kn">from</span> <span class="nn">dialogy.workflow</span> <span class="kn">import</span> <span class="n">Workflow</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span><span class="k">class</span> <span class="nc">ASolitaryPlugin</span><span class="p">(</span><span class="n">Plugin</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<span class="gp">   ...: </span>        <span class="bp">self</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PluginFn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">mutate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PluginFn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">   ...: </span>    <span class="p">):</span>
<span class="gp">   ...: </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">access</span><span class="o">=</span><span class="n">access</span><span class="p">,</span> <span class="n">mutate</span><span class="o">=</span><span class="n">mutate</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="nf">utility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="gp">   ...: </span>        <span class="k">return</span> <span class="kc">None</span>
<span class="gp">   ...: </span>
</pre></div>
</div>
</div></blockquote>
<p>Let’s take an example of a plugin that concatenates the transcripts from an ASR to a <code class="code docutils literal notranslate"><span class="pre">str</span></code>.</p>
<blockquote>
<div><div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="k">class</span> <span class="nc">MergeASRPlugin</span><span class="p">(</span><span class="n">Plugin</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<span class="gp">   ...: </span>        <span class="bp">self</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">start_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"&lt;s&gt;"</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">end_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"&lt;/s&gt;"</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PluginFn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">mutate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PluginFn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">   ...: </span>    <span class="p">):</span>
<span class="gp">   ...: </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">access</span><span class="o">=</span><span class="n">access</span><span class="p">,</span> <span class="n">mutate</span><span class="o">=</span><span class="n">mutate</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
<span class="gp">   ...: </span>        <span class="c1"># Always validate the input.</span>
<span class="gp">   ...: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">start_token</span> <span class="o">=</span> <span class="n">start_token</span>
<span class="gp">   ...: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">end_token</span> <span class="o">=</span> <span class="n">start_token</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="nf">utility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="gp">   ...: </span>        <span class="c1"># Always validate the input.</span>
<span class="gp">   ...: </span>        <span class="n">transcripts</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">   ...: </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_token</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_token</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_token</span><span class="si">}</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">transcripts</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_token</span>
<span class="gp">   ...: </span>

<span class="gp">In [3]: </span><span class="n">MergeASRPlugin</span><span class="p">()</span><span class="o">.</span><span class="n">utility</span><span class="p">([</span><span class="s2">"hello world"</span><span class="p">,</span> <span class="s2">"hello worlds"</span><span class="p">,</span> <span class="s2">"hello word"</span><span class="p">])</span>
<span class="gh">Out[3]: </span><span class="go">'&lt;s&gt;hello world&lt;s&gt; &lt;s&gt;hello worlds&lt;s&gt; &lt;s&gt;hello word&lt;s&gt;'</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="input">
<h6>Input<a class="headerlink" href="#input" title="Permalink to this headline">¶</a></h6>
<p>Previously we saw that the utility method produces results on expected inputs. We will now see how to get the same from a workflow.</p>
<blockquote>
<div><div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="k">def</span> <span class="nf">get_classifier_input</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">Workflow</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="gp">   ...: </span>    <span class="k">return</span> <span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">"transcripts"</span><span class="p">],)</span>
<span class="gp">   ...: </span>
</pre></div>
</div>
</div></blockquote>
<p>This is an accessor function, these expect a workflow instance as their only argument and can return anything currently available.
These accessor functions are written by workflow creators and allow someone to use core plugins as long as plugins specify the input, output types.</p>
</section>
<section id="output">
<h6>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h6>
<p>Once the plugin produces an output, we may want to keep it somwhere in the workflow. In this case we rely on mutator functions to send
the plugin output back to the workflow. These are also written by workflow creators and hence any updates are plugin agnostic.</p>
<blockquote>
<div><div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="k">def</span> <span class="nf">set_classifier_input</span><span class="p">(</span><span class="n">workflow</span><span class="p">:</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="gp">   ...: </span>    <span class="sd">'''</span>
<span class="gp">   ...: </span><span class="sd">    We would normally overwrite the input but since a workflow</span>
<span class="gp">   ...: </span><span class="sd">    loses inputs once run; and returns only a copy of the output,</span>
<span class="gp">   ...: </span><span class="sd">    we are creating a new key within the output.</span>
<span class="gp">   ...: </span><span class="sd">    '''</span>
<span class="gp">   ...: </span>    <span class="n">workflow</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">"transcripts"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="gp">   ...: </span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="integrations">
<h6>Integrations<a class="headerlink" href="#integrations" title="Permalink to this headline">¶</a></h6>
<p>Now we fit the pieces together and can visualize the interactions between a workflow and a plugin.</p>
<blockquote>
<div><div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">w</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">([</span><span class="n">MergeASRPlugin</span><span class="p">(</span><span class="n">access</span><span class="o">=</span><span class="n">get_classifier_input</span><span class="p">,</span> <span class="n">mutate</span><span class="o">=</span><span class="n">set_classifier_input</span><span class="p">)])</span>
<span class="gp">   ...: </span><span class="n">w</span><span class="o">.</span><span class="n">output</span>
<span class="gp">   ...: </span><span class="n">w</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s2">"transcripts"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"hello world"</span><span class="p">,</span> <span class="s2">"hello worlds"</span><span class="p">,</span> <span class="s2">"hello word"</span><span class="p">]})</span>
<span class="gp">   ...: </span>
<span class="gh">Out[6]: </span><span class="go"></span>
<span class="go">{'intents': [],</span>
<span class="go"> 'entities': [],</span>
<span class="go"> 'transcripts': '&lt;s&gt;hello world&lt;s&gt; &lt;s&gt;hello worlds&lt;s&gt; &lt;s&gt;hello word&lt;s&gt;'}</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="transformer">
<h5>Transformer<a class="headerlink" href="#transformer" title="Permalink to this headline">¶</a></h5>
<p>Transformer plugins are solitary plugins that can additionally transform dataframes. These can be used for producing new features or modify existing ones.
If we remember the MergeASRPlugin plugin we have built so far, it does perform its transformation on a single data point expected at runtime but transformations
happen during the training phase of a workflow.</p>
<p>Let’s try to build a transformer plugin that will add a new column to a dataframe.</p>
<blockquote>
<div><div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">   ...: </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span><span class="k">class</span> <span class="nc">MergeASRPlugin</span><span class="p">(</span><span class="n">Plugin</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<span class="gp">   ...: </span>        <span class="bp">self</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">start_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"&lt;s&gt;"</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">end_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"&lt;/s&gt;"</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PluginFn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">mutate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PluginFn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">input_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"alternatives"</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">output_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"concat_alternatives"</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">use_transform</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">   ...: </span>    <span class="p">):</span>
<span class="gp">   ...: </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">access</span><span class="o">=</span><span class="n">access</span><span class="p">,</span> <span class="n">mutate</span><span class="o">=</span><span class="n">mutate</span><span class="p">,</span> <span class="n">input_column</span><span class="o">=</span><span class="n">input_column</span><span class="p">,</span> <span class="n">output_column</span><span class="o">=</span><span class="n">output_column</span><span class="p">,</span> <span class="n">use_transform</span><span class="o">=</span><span class="n">use_transform</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
<span class="gp">   ...: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">start_token</span> <span class="o">=</span> <span class="n">start_token</span>
<span class="gp">   ...: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">end_token</span> <span class="o">=</span> <span class="n">start_token</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="nf">utility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="gp">   ...: </span>        <span class="n">transcripts</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">   ...: </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_token</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_token</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_token</span><span class="si">}</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">transcripts</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_token</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="nf">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">   ...: </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">utility</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="gp">   ...: </span>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_transform</span><span class="p">:</span>
<span class="gp">   ...: </span>            <span class="k">return</span> <span class="n">training_data</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span>        <span class="n">training_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">output_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">training_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">)</span>
<span class="gp">   ...: </span>        <span class="k">return</span> <span class="n">training_data</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"alternatives"</span><span class="p">:</span> <span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([</span><span class="s2">"hello world"</span><span class="p">,</span> <span class="s2">"helo world"</span><span class="p">]),</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([</span><span class="s2">"today only"</span><span class="p">,</span> <span class="s2">"today"</span><span class="p">])]})</span>
<span class="gp">   ...: </span><span class="n">MergeASRPlugin</span><span class="p">(</span><span class="n">input_column</span><span class="o">=</span><span class="s2">"alternatives"</span><span class="p">,</span> <span class="n">output_column</span><span class="o">=</span><span class="s2">"updated_alternatives"</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="gp">   ...: </span>
<span class="gh">Out[7]: </span><span class="go"></span>
<span class="go">                    alternatives                updated_alternatives</span>
<span class="go">0  ["hello world", "helo world"]  &lt;s&gt;hello world&lt;s&gt; &lt;s&gt;helo world&lt;s&gt;</span>
<span class="go">1        ["today only", "today"]        &lt;s&gt;today only&lt;s&gt; &lt;s&gt;today&lt;s&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>and the lifecycle of its demo will be covered in a later section once we have an understanding of a trainable plugin.</p>
</section>
<section id="trainable">
<h5>Trainable<a class="headerlink" href="#trainable" title="Permalink to this headline">¶</a></h5>
<p>Trainable plugins are solitary plugins that can additionally train dataframes. A trainable plugin may optionally be able to transform dataframes as well.
Now we will build a new demo plugin that will train a classifier on a dataframe.</p>
<blockquote>
<div><div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="gp">   ...: </span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="gp">   ...: </span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="gp">   ...: </span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfTransformer</span>
<span class="gp">   ...: </span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="gp">   ...: </span>

<span class="gp">In [9]: </span><span class="k">class</span> <span class="nc">TreeClassifierPlugin</span><span class="p">(</span><span class="n">Plugin</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<span class="gp">   ...: </span>        <span class="bp">self</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">access</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PluginFn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">mutate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PluginFn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">x_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"alternatives"</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">y_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"intents"</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">   ...: </span>    <span class="p">):</span>
<span class="gp">   ...: </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">access</span><span class="o">=</span><span class="n">access</span><span class="p">,</span> <span class="n">mutate</span><span class="o">=</span><span class="n">mutate</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
<span class="gp">   ...: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
<span class="gp">   ...: </span>            <span class="p">(</span><span class="s1">'vect'</span><span class="p">,</span> <span class="n">CountVectorizer</span><span class="p">()),</span>
<span class="gp">   ...: </span>            <span class="p">(</span><span class="s1">'tfidf'</span><span class="p">,</span> <span class="n">TfidfTransformer</span><span class="p">()),</span>
<span class="gp">   ...: </span>            <span class="p">(</span><span class="s1">'clf'</span><span class="p">,</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>
<span class="gp">   ...: </span>        <span class="p">])</span>
<span class="gp">   ...: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">x_col</span> <span class="o">=</span> <span class="n">x_col</span>
<span class="gp">   ...: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">y_col</span> <span class="o">=</span> <span class="n">y_col</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="gp">   ...: </span>        <span class="n">X</span> <span class="o">=</span> <span class="n">training_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_col</span><span class="p">]</span>
<span class="gp">   ...: </span>        <span class="n">y</span> <span class="o">=</span> <span class="n">training_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y_col</span><span class="p">]</span>
<span class="gp">   ...: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">   ...: </span>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
<span class="gp">   ...: </span>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">handle</span><span class="p">)</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">   ...: </span>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
<span class="gp">   ...: </span>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="nf">utility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="gp">   ...: </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"alternatives"</span><span class="p">:</span> <span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([</span><span class="s2">"yes"</span><span class="p">,</span> <span class="s2">"yea"</span><span class="p">]),</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([</span><span class="s2">"no"</span><span class="p">,</span> <span class="s2">"nope"</span><span class="p">])],</span> <span class="s2">"intents"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"affirmative"</span><span class="p">,</span> <span class="s2">"negative"</span><span class="p">]})</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span><span class="k">def</span> <span class="nf">set_classifier_output</span><span class="p">(</span><span class="n">workflow</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">   ...: </span>   <span class="n">workflow</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">"intents"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="gp">   ...: </span>
<span class="gp">   ...: </span><span class="k">def</span> <span class="nf">set_classifier_input</span><span class="p">(</span><span class="n">workflow</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">   ...: </span>   <span class="n">workflow</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">"transcripts"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="gp">   ...: </span>

<span class="gp">In [10]: </span><span class="n">w</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">([</span><span class="n">MergeASRPlugin</span><span class="p">(</span><span class="n">access</span><span class="o">=</span><span class="n">get_classifier_input</span><span class="p">,</span> <span class="n">mutate</span><span class="o">=</span><span class="n">set_classifier_input</span><span class="p">,</span> <span class="n">input_column</span><span class="o">=</span><span class="s2">"alternatives"</span><span class="p">,</span> <span class="n">use_transform</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">TreeClassifierPlugin</span><span class="p">(</span><span class="n">access</span><span class="o">=</span><span class="n">get_classifier_input</span><span class="p">,</span> <span class="n">mutate</span><span class="o">=</span><span class="n">set_classifier_output</span><span class="p">,</span> <span class="n">x_col</span><span class="o">=</span><span class="s2">"concat_alternatives"</span><span class="p">,</span> <span class="n">y_col</span><span class="o">=</span><span class="s2">"intents"</span><span class="p">)])</span>

<span class="gp">In [11]: </span><span class="n">w</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="gp">In [12]: </span><span class="n">w</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s2">"transcripts"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"yes"</span><span class="p">]})</span>
<span class="gh">Out[12]: </span><span class="go">{'intents': array(['affirmative'], dtype=object), 'entities': []}</span>
</pre></div>
</div>
</div></blockquote>
<p>Notes:</p>
<ul class="simple">
<li><p>If your plugin needs a model but it need not be trained frequently or is just an off the shelf pre-trained model, then you must go for a Solitary plugin.</p></li>
<li><p>A trainable plugin can also have transform methods if it must modify a dataframe for other plugins in place.</p></li>
</ul>
<dl class="py class">
<dt class="sig sig-object py" id="dialogy.base.plugin.Plugin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Plugin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">access</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mutate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'alternatives'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/dialogy/base/plugin.html#Plugin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dialogy.base.plugin.Plugin" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABC</span></code></p>
<p>A <a class="reference internal" href="#plugin"><span class="std std-ref">Plugin</span></a> object provides utilities that perform a transformation. A <a class="reference internal" href="#plugin"><span class="std std-ref">Plugin</span></a> object differs
in behaviour depending on it’s purpose. Purpose defines stages in a <a class="reference internal" href="dialogy.workflow.html#workflow"><span class="std std-ref">Workflow</span></a>’s lifecycle.
These are namely: <code class="docutils literal notranslate"><span class="pre">train</span></code>, <code class="docutils literal notranslate"><span class="pre">test</span></code> and <code class="docutils literal notranslate"><span class="pre">production</span></code>.</p>
<p>A <a class="reference internal" href="#plugin"><span class="std std-ref">Plugin</span></a> object:</p>
<ul class="simple">
<li><p>May be trained, expected during the <code class="docutils literal notranslate"><span class="pre">train</span></code> lifecycle.</p></li>
<li><p>May transform a dataframe, expected during the <code class="docutils literal notranslate"><span class="pre">test</span></code> lifecycle.</p></li>
<li><p>Transforms a datapoint, expected during the <code class="docutils literal notranslate"><span class="pre">production</span></code> lifecycle.</p></li>
</ul>
<p>Imagine a workflow processing a dataframe. Sequencing plugins like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">-&gt;</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span> <span class="o">-&gt;</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="n">end</span>
</pre></div>
</div>
<p>Let’s assume that the plugin B, and C are plugins that can transform data without any training.
However, plugins A and D require training and transform data. The data transformations differ slightly as per
the <a class="reference internal" href="dialogy.workflow.html#workflow"><span class="std std-ref">workflow</span></a> life-cycle.</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>During the training phase:</dt><dd><ol class="arabic simple">
<li><p>Plugin A starts training on a dataframe and then transforms the data.</p></li>
<li><p>Plugin B, C start transforming the dataframe received from A.</p></li>
<li><p>Plugin D starts trains on the dataframe received from C.</p></li>
</ol>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>During the evaluation phase:</dt><dd><ol class="arabic simple">
<li><p>Each plugin performs its own transformation and passes data ahead.</p></li>
</ol>
</dd>
</dl>
</li>
</ol>
<p>How does plugin P2 get trained if plugin P1 requires data from an incompatable dataframe?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">-&gt;</span> <span class="n">P1</span> <span class="o">-&gt;</span> <span class="n">P2</span> <span class="o">-&gt;</span> <span class="n">end</span>
</pre></div>
</div>
<p>Given that the production lifecycle implies that a plugin either receives the base features
straight from the <a class="reference internal" href="dialogy.workflow.html#workflow"><span class="std std-ref">Workflow</span></a> or its derivates via transformations from pre-existing plugins.</p>
<p>Therefore we can redefine incompatibility as follows:</p>
<ol class="arabic simple">
<li><p>Label differences, i.e. P1 trains on Transcription dataframes but P2 trains on Intent Classification dataframes.</p></li>
<li><p>Feature differences, i.e. P1 trains on confidence scores but P2 trains on ASR transcripts.</p></li>
</ol>
<p>Plugins require a method for validation to ensure the data they receive matches the data they are expected to process.
If the validation fails, plugins must not interrupt the training by raising exceptions.</p>
<p>Speaking from our example, P1 gets trained and P2 remaines untrained. This doesn’t sound intuitive but
that’s because we are looking at plugins within a <a class="reference internal" href="dialogy.workflow.html#workflow"><span class="std std-ref">workflow</span></a>. As a remedy, <span class="xref std std-ref">plugins</span>
can be trained in isolation. A plugin author still must provide <code class="docutils literal notranslate"><span class="pre">train</span></code>, <code class="docutils literal notranslate"><span class="pre">transform</span></code> and <code class="docutils literal notranslate"><span class="pre">utility</span></code>
methods for a trainable plugin.</p>
<p><strong>Input</strong></p>
<p><a class="reference internal" href="#plugin"><span class="std std-ref">Plugin</span></a> instantiation provides the configuration but transformation is done by applying
functions on a <a class="reference internal" href="dialogy.workflow.html#workflow"><span class="std std-ref">Workflow</span></a>. This way the seemingly linear sequence of plugins has the freedom to
access anything committed to the <a class="reference internal" href="dialogy.workflow.html#workflow"><span class="std std-ref">Workflow</span></a>.</p>
<p><strong>Output</strong></p>
<p>Post transformation we need the plugin to commit a <code class="docutils literal notranslate"><span class="pre">value</span></code>. This value is not passed to the next plugin, instead we commit
everything to the <a class="reference internal" href="dialogy.workflow.html#workflow"><span class="std std-ref">Workflow</span></a> by applying a <code class="docutils literal notranslate"><span class="pre">mutate</span></code> function with the <code class="docutils literal notranslate"><span class="pre">value</span></code> over to the <a class="reference internal" href="dialogy.workflow.html#workflow"><span class="std std-ref">Workflow</span></a>.</p>
<p><strong>Trainable Plugins</strong></p>
<p>If a <a class="reference internal" href="#plugin"><span class="std std-ref">Plugin</span></a> is trainable, it must implement these methods:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">train(x:</span> <span class="pre">pd.DataFrame)</span> <span class="pre">-&gt;</span> <span class="pre">Plugin</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">utility(...)</span> <span class="pre">-&gt;</span> <span class="pre">Any</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">validate(x:</span> <span class="pre">pd.DataFrame)</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">save()</span> <span class="pre">-&gt;</span> <span class="pre">Plugin</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">load()</span> <span class="pre">-&gt;</span> <span class="pre">Plugin</span></code></p></li>
</ol>
<p><strong>Transformer Plugins</strong></p>
<p>If a <a class="reference internal" href="#plugin"><span class="std std-ref">Plugin</span></a> transforms data and produces trainable features, it must implement these methods:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">transform(x:</span> <span class="pre">pd.DataFrame)</span> <span class="pre">-&gt;</span> <span class="pre">pd.DataFrame</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">utility(...)</span> <span class="pre">-&gt;</span> <span class="pre">Any</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">validate(x:</span> <span class="pre">pd.DataFrame)</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code></p></li>
</ol>
<p><strong>Base Plugins</strong></p>
<p>If a <a class="reference internal" href="#plugin"><span class="std std-ref">Plugin</span></a> is expected to transform isolated data points (no-training, no feature generation):</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">utility(...)</span> <span class="pre">-&gt;</span> <span class="pre">Any</span></code></p></li>
</ol>
<dl class="py method">
<dt class="sig sig-object py" id="dialogy.base.plugin.Plugin.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/dialogy/base/plugin.html#Plugin.train"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dialogy.base.plugin.Plugin.train" title="Permalink to this definition">¶</a></dt>
<dd><p>Train a plugin.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code></p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="dialogy.base.plugin.Plugin.transform">
<span class="sig-name descname"><span class="pre">transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">training_data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/dialogy/base/plugin.html#Plugin.transform"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dialogy.base.plugin.Plugin.transform" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform data for a plugin in the workflow.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code></p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="dialogy.base.plugin.Plugin.utility">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">utility</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/dialogy/base/plugin.html#Plugin.utility"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dialogy.base.plugin.Plugin.utility" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform X -&gt; y.</p>
<p>This method is called during a <a class="reference internal" href="dialogy.workflow.html#workflow"><span class="std std-ref">Workflow</span></a> run.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A value that will be passed to the next plugin (if any).</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Any</p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</section>
</section>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="dialogy.types.intent.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">dialogy.types.intent package</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="dialogy.workflow.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">dialogy.workflow package</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169;  |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="../_sources/source/dialogy.base.plugin.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">dialogy.base.plugin package</a><ul>
<li><a class="reference internal" href="#module-dialogy.base.plugin">Module contents</a><ul>
<li><a class="reference internal" href="#writing-plugins">Writing Plugins</a><ul>
<li><a class="reference internal" href="#plugin-types">Plugin Types</a><ul>
<li><a class="reference internal" href="#solitary">Solitary</a><ul>
<li><a class="reference internal" href="#methods">Methods</a></li>
<li><a class="reference internal" href="#input">Input</a></li>
<li><a class="reference internal" href="#output">Output</a></li>
<li><a class="reference internal" href="#integrations">Integrations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transformer">Transformer</a></li>
<li><a class="reference internal" href="#trainable">Trainable</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    </body>
</html>